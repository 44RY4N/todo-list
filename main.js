(()=>{"use strict";const e={currentProject:null,allProjects:[]},t="todoList",o={save(e){try{const o=e.map((e=>e.toJSON()));return localStorage.setItem(t,JSON.stringify(o)),!0}catch(e){return console.error("Error saving to localStorage:",e),!1}},load(){try{const e=localStorage.getItem(t);return e?JSON.parse(e).map((e=>{const t=E(e.title,e.desc);return t.id=e.id,e.todos.forEach((e=>{const o=c(e.title,e.description,e.duedate,e.priority,e.checked);o.id=e.id,t.add(o)})),t})):[]}catch(e){return console.error("Error loading from localStorage:",e),[]}},clear(){try{return localStorage.removeItem(t),!0}catch(e){return console.error("Error clearing localStorage:",e),!1}}};class n{static copy=1;static id=1;constructor(e,t,o,c,r){this.title=e||"Note#"+n.copy++,this.description=t||"no description",this.duedate=o||"no duedate",this.priority=c||0,this.checked=r||!1,this.id=n.id++}showTodo(){var e;e=this,console.log(`Todo Title => ${e.title}`),console.log(`Todo description => ${e.description}`),console.log(`Todo duedate => ${e.duedate}`),console.log(`Todo priority => ${e.priority}`),console.log(`Todo check status => ${e.checked}`)}toJSON(){return{title:this.title,description:this.description,duedate:this.duedate,priority:this.priority,checked:this.checked,id:this.id}}}function c(t,c,r,d,l){let i=new n(t,c,r,d,l);return v(i),o.save(e.allProjects),i}const r=document.querySelector("#overlay"),d=document.createElement("div"),l=document.createElement("input");l.id="popTodoTitle",l.type="text",l.maxLength="30",l.placeholder="Enter Todo Title";const i=document.createElement("textarea");i.maxLength="300",i.id="popTodoDesc",i.placeholder="Description...";const s=document.createElement("input");s.type="date",s.id="popTodoDuedate";const a=document.createElement("input");a.type="number",a.placeholder="1-9",a.max="9",a.min="1",a.id="popTodoPriority";const u=document.createElement("button");let p=null;function m(){document.querySelector("#popPro").style.display="none",document.querySelector("#popTo").style.display="flex",r.style.display="flex",p=null,u.textContent="Add Todo"}u.textContent="Add Todo",u.addEventListener("click",(()=>{if(a.value>9||a.value<0)alert("Enter a valid priority (1-9)");else{if(null!==p){console.log(`Editing todo with ID: ${p}`),c(l.value,i.value,s.value||"no duedate",a.value||0,!1);const t=e.currentProject?.items.find((e=>e.id===p)),n=document.querySelector(`[data-todo-id="${p}"]`);console.log("Old todo:",t),console.log("Old todo element:",n),t&&n?(j(t,n),o.save(e.allProjects)):console.error("Failed to find old todo or element for deletion:",{oldTodo:t,oldTodoElement:n}),p=null,u.textContent="Add Todo"}else console.log("Creating new todo"),c(l.value,i.value,s.value||"no duedate",a.value||0,!1);r.style.display="none",l.value="",i.value="",s.value="",a.value=""}})),d.appendChild(l),d.appendChild(i),d.appendChild(s),d.appendChild(a),d.appendChild(u),r.addEventListener("click",(()=>{r.style.display="none",p=null,u.textContent="Add Todo"})),d.id="popTo",r.appendChild(d),d.addEventListener("click",(e=>e.stopPropagation()));const y=document.querySelector("#content"),h=document.querySelector("#overlay");function v(t,n=!0){if(n){if(!e.currentProject||"string"==typeof e.currentProject)return void console.error("No valid project selected.");e.currentProject.add(t)}console.log("adding todo to dom"),console.log(n),n&&(console.log(`state.currentProject.length = ${e.currentProject.items.length}`),1==e.currentProject.items.length&&(y.innerHTML=""));const c=document.createElement("div");c.classList.add("todoContainer");const r=document.createElement("div");r.classList.add("todoTitle");const d=document.createElement("div");d.classList.add("todoDesc");const l=document.createElement("div");l.classList.add("todoDuedate");const i=document.createElement("div");i.classList.add("todoPriority");const s=document.createElement("div");s.classList.add("todoChecked"),r.textContent=t.title,d.textContent=t.description,d.addEventListener("click",(()=>{console.log("descn clicked"),h.style.display="flex",console.log("overlay changed");const e=document.querySelector("#popPro"),o=document.querySelector("#popTo");e.style.display="none",o.style.display="none";const n=document.createElement("div");n.id="fulldesc",n.textContent=t.description,h.appendChild(n),h.addEventListener("click",(()=>{n.style.display="none",h.style.display="none"}))})),l.textContent=t.duedate,i.textContent=`Priority: ${t.priority}`,s.textContent="currently: Incomplete",c.classList.add("incomplete");let a=t.priority;a>6&&a<10?c.classList.add("high"):a>3&&a<7?c.classList.add("med"):c.classList.add("low");const v=document.createElement("div");v.textContent="*click on description to expand it",v.id="opts";const g=document.createElement("div");g.id="del",g.textContent="❌",c.dataset.todoId=t.id,g.addEventListener("click",(()=>{v.classList.contains("disabled")||(j(t,c),o.save(e.allProjects))})),v.appendChild(g);const P=document.createElement("div");P.id="edit",P.textContent="✏️",P.addEventListener("click",(()=>{v.classList.contains("disabled")||function(e){m(),p=e.id,u.textContent="Done",document.querySelector("#popTodoTitle").value=e.title,document.querySelector("#popTodoDesc").value=e.description,document.querySelector("#popTodoDuedate").value="no duedate"===e.duedate||isNaN(e.duedate)?"":new Date(e.duedate).toISOString().split("T")[0],document.querySelector("#popTodoPriority").value=e.priority}(t)})),v.appendChild(P),s.addEventListener("click",(e=>{if(e.currentTarget.parentElement.classList.contains("complete"))return e.currentTarget.parentElement.classList.add("incomplete"),e.currentTarget.parentElement.classList.remove("complete"),e.currentTarget.textContent="currently: Incomplete",v.classList.remove("disabled"),void(t.checked=!1);e.currentTarget.parentElement.classList.remove("incomplete"),e.currentTarget.parentElement.classList.add("complete"),e.currentTarget.textContent="currently: Completed",v.classList.add("disabled"),t.checked=!0})),t.checked&&(c.classList.remove("incomplete"),c.classList.add("complete"),s.textContent="currently: Completed",v.classList.add("disabled")),c.appendChild(r),c.appendChild(d),c.appendChild(l),c.appendChild(i),c.appendChild(s),c.appendChild(v),y.appendChild(c)}function j(t,o){e.currentProject&&"string"!=typeof e.currentProject?(e.currentProject.items=e.currentProject.items.filter((e=>e.id!==t.id)),o.remove(),0===e.currentProject.items.length&&(y.textContent="No todos in this project.")):console.error("No valid project selected.")}const g=document.querySelector("#content"),P=document.querySelector("#projectContainer");class f{static copy=1;static id=1;constructor(e,t){this.title=e||"Project#"+f.copy++,this.desc=t||"no description",this.items=[],this.id=f.id++}showProject(){!function(e){console.log(`Project Title => ${e.title}`),console.log(`Project desc => ${e.desc}`),console.log("Project items");for(const t of e.items)console.log(t.title)}(this)}add(e){this.items.push(e)}toJSON(){return{title:this.title,desc:this.desc,id:this.id,todos:this.items.map((e=>e.toJSON()))}}}function E(t,n){let c=new f(t,n);return e.allProjects.push(c),function(t){const n=document.createElement("div");n.classList.add("projectTitle"),n.textContent=t.title,n.dataset.projectId=t.id,o.save(e.allProjects),n.addEventListener("click",(t=>{t.currentTarget.dataset.projectId!=e.currentProject?.id&&(console.log("event listner added"),function(t){g.innerHTML="";const o=Number(t.currentTarget.dataset.projectId),n=e.allProjects.find((e=>e.id===o));if(!n)return console.error("Project not found for ID:",o),void(g.textContent="Project not found.");if(0===n.items.length)g.textContent="No todos in this project.";else for(let e of n.items)v(e,!1);e.currentProject=n,console.log("Project found",n.title)}(t))})),P.appendChild(n)}(c),c}const C=document.querySelector("#overlay"),T=document.createElement("div"),L=document.createElement("input"),S=document.createElement("textarea"),x=document.createElement("button");L.type="text",L.placeholder="Enter project title",S.placeholder="desc...",x.textContent="Add Project",x.addEventListener("click",(()=>{E(L.value,S.value),C.style.display="none",L.value="",S.value=""})),T.appendChild(L),T.appendChild(S),T.appendChild(x),C.addEventListener("click",(()=>{C.style.display="none"})),T.id="popPro",C.appendChild(T),T.addEventListener("click",(e=>e.stopPropagation()));const k=document.querySelector("#content"),q=document.querySelector("#content"),N=document.querySelector("#content"),D=document.querySelector("header"),w=document.createElement("h1");if(w.textContent="Your Digital Todo-List",D.appendChild(w),e.allProjects=o.load(),0===e.allProjects.length){let t=E("",""),n=c("","example project","","",!1);t.addTodo(n),e.allProjects.push(t),o.save(e.allProjects)}console.log("all projects in index"),document.querySelector("#project").addEventListener("click",(function(){document.querySelector("#popTo").style.display="none",document.querySelector("#popPro").style.display="flex",C.style.display="flex"})),document.querySelector("#newtodo").addEventListener("click",m),document.querySelector("#daily").addEventListener("click",(function(){const t=(new Date).toISOString().split("T")[0];if(!e.currentProject||"string"==typeof e.currentProject)return console.error("No valid project selected."),void(k.innerHTML="Please select a project to view today's todos.");const o=e.allProjects.flatMap((e=>e.items.filter((e=>!("no duedate"===e.duedate||!e.duedate)&&(isNaN(e.duedate)?e.duedate:new Date(e.duedate).toISOString().split("T")[0])===t))));k.innerHTML="",0===o.length?k.textContent="No todos due today.":o.forEach((e=>{v(e,!1)}))})),document.querySelector("#weekly").addEventListener("click",(function(){const t=new Date,o=t.getDay(),n=new Date(t);n.setDate(t.getDate()-(0===o?6:o-1)),n.setHours(0,0,0,0);const c=new Date(n);c.setDate(n.getDate()+6),c.setHours(23,59,59,999);const r=e.allProjects.flatMap((e=>e.items.filter((e=>{if("no duedate"===e.duedate||!e.duedate)return!1;const t=(isNaN(e.duedate),new Date(e.duedate));return t>=n&&t<=c}))));q.innerHTML="",0===r.length?q.textContent="No todos due this week.":r.forEach((e=>{v(e,!1)}))})),document.querySelector("#all").addEventListener("click",(function(){if(!e.currentProject||"string"==typeof e.currentProject)return console.error("No valid project selected."),void(N.innerHTML="Please select a project to view todos.");N.innerHTML="",0===e.currentProject.items.length?N.textContent="No todos in this project.":e.currentProject.items.forEach((e=>{v(e,!1)}))})),document.querySelector("#delProject").addEventListener("click",(function(){if(!e.currentProject)return void console.warn("No project selected to delete.");const t=document.querySelector("#projectContainer");if(t){const o=t.querySelector(`[data-project-id="${e.currentProject.id}"]`);o&&o.remove()}e.allProjects=e.allProjects.filter((t=>t.id!==e.currentProject.id)),e.currentProject=e.allProjects[0]||null;const n=document.querySelector("#content");n&&(n.innerHTML="",e.currentProject?e.currentProject.items.forEach((e=>{v(e,!1)})):n.textContent="No project selected."),o.save(e.allProjects)})),document.querySelector("#projectContainer div").click()})();